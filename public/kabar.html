<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Si-Mbah | Kabar Herbal Terkini</title>

    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" href="/css/navbar.css"> 
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/chat.css">
    
    <link rel="stylesheet" href="/css/kabar.css">
    
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="/js/main.js" defer></script> 
</head>
<body>
    <header class="navbar scrolled">
        <a href="/index.html" class="navbar-logo">
            <img src="/favicon.png" alt="Logo SiMbah" class="logo-icon">
            Si-Mbah<span>.</span>
        </a>
        <nav class="navbar-nav">
            <a href="/index.html">Home</a>
            <a href="/catatan.html">Catatan</a>
            <a href="/kabar.html">Kabar</a>
            <a href="/referensi.html">Referensi</a>
        </nav>
        <div class="navbar-extra">
            <a href="#" id="hamburger-menu"><i data-feather="menu"></i></a>
        </div>
    </header>

    <main class="news-section">
        <div class="container">
            <div class="news-header">
                <h1><i data-feather="feather"></i> Kabar-Mbah <i data-feather="feather"></i></h1>
                <p>Jelajahi berita, riset, dan tips terbaru dari dunia herbal dan pengobatan tradisional Indonesia.</p>
            </div>
            
            <div id="news-container" class="news-grid">
                <div class="loading-indicator">
                    <p>Sedang memuat berita...</p>
                </div>
            </div>
            
            <div class="pagination-controls" id="pagination-controls" style="display:none">
                <button class="page-btn" id="prev-btn" disabled>Prev</button>
                <span class="page-info" id="page-info">Halaman 1</span>
                <button class="page-btn" id="next-btn" disabled>Next</button>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                
                <div class="footer-col">
                    <a href="#" class="footer-logo">
                        <img src="favicon.png" alt="Logo Si-Mbah" class="footer-logo-img"> 

                        Si-Mbah<span>.</span>
                    </a>
                    <p class="footer-mission">Melestarikan warisan herbal Indonesia melalui teknologi untuk generasi mendatang.</p>
                </div>
                
                <div class="footer-col">
                    <h4 class="footer-heading">Jelajahi</h4>
                    <ul class="footer-links">
                        <li><a href="#">Beranda</a></li>
                        <li><a href="#features">Fitur</a></li>
                        <li><a href="#">Tentang Kami</a></li>
                        <li><a href="#">Kontak</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h4 class="footer-heading">Dukungan</h4>
                    <ul class="footer-links">
                        <li><a href="#">Pusat Bantuan</a></li>
                        <li><a href="#">Kebijakan Privasi</a></li>
                        <li><a href="#">Syarat & Ketentuan</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h4 class="footer-heading">Terhubung Dengan Kami</h4>
                    <div class="social-links">
                        <a href="#" aria-label="Instagram"><i data-feather="instagram"></i></a>
                        <a href="#" aria-label="Facebook"><i data-feather="facebook"></i></a>
                        <a href="#" aria-label="Twitter"><i data-feather="twitter"></i></a>
                        <a href="#" aria-label="Youtube"><i data-feather="youtube"></i></a>
                    </div>
                </div>
                
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Si-Mbah. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div id="chat-bubble" class="chat-bubble">
        <i data-feather="message-square"></i>
    </div>

    <div id="chat-window" class="chat-window hidden">
        <div class="chat-header">
            <div class="header-title">
                <img src="mbah.png" alt="Icon Mbah" class="header-icon">
                <h3>Tanya-Mbah</h3>
            </div>
            <div class="header-buttons">
                <button id="clear-chat-btn" title="Hapus Obrolan"><i data-feather="trash-2"></i></button>
                <button id="collapse-chat-btn" title="Perkecil"><i data-feather="chevron-down"></i></button>
                <button id="close-chat-btn" title="Tutup"><i data-feather="x"></i></button>
            </div>
        </div>
        <div id="chat-messages" class="chat-messages">
            </div>
        <div class="chat-input-area">
            <form id="chat-form">
                <input type="text" id="chat-input" placeholder="Ketik pertanyaan Anda..." disabled>
                <button type="submit" id="send-btn" disabled><i data-feather="send"></i></button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const newsContainer = document.getElementById('news-container');
            const paginationControls = document.getElementById('pagination-controls');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const pageInfo = document.getElementById('page-info');

            let currentPage = 1;
            let totalResults = 0;
            const pageSize = 9;
            const dummyCategories = ['Riset', 'Tips', 'Tradisi']; // Kategori dummy untuk visual

            const fetchNews = async (page = 1) => {
                try {
                    newsContainer.innerHTML = '<div class="loading-indicator"><p>Sedang memuat berita...</p></div>';
                    const response = await fetch(`/api/news?page=${page}`);

                    if (!response.ok) {
                        throw new Error(`Gagal mengambil data: Status ${response.status}`);
                    }

                    const data = await response.json();
                    totalResults = data.totalResults || 0;
                    newsContainer.innerHTML = '';

                    if (data.articles && data.articles.length > 0) {
                        data.articles.forEach((article, index) => {
                            const imageUrl = article.urlToImage || '/placeholder-image.jpg';
                            const title = article.title || 'Judul tidak tersedia';
                            const description = article.description || 'Deskripsi tidak tersedia.';
                            const sourceName = article.source.name || 'Sumber tidak diketahui';
                            const publishedDate = new Date(article.publishedAt).toLocaleDateString('id-ID', {
                                day: 'numeric', month: 'long', year: 'numeric'
                            });
                            
                            // Logika untuk Artikel Unggulan: artikel pertama di halaman pertama
                            const isFeatured = (index === 0 && page === 1);
                            const cardClass = isFeatured ? 'news-card featured' : 'news-card';
                            
                            // Pilih kategori secara acak untuk demo visual
                            const category = dummyCategories[Math.floor(Math.random() * dummyCategories.length)];

                            const articleCard = `
                                <div class="${cardClass}" style="animation-delay: ${index * 100}ms;">
                                    <div class="card-image">
                                        <img src="${imageUrl}" alt="${title}" loading="lazy">
                                    </div>
                                    <div class="card-content">
                                        <span class="card-category">${category}</span>
                                        <p class="card-meta">${sourceName} &bull; ${publishedDate}</p>
                                        <h3 class="card-title">${title}</h3>
                                        <p class="card-description">${description}</p>
                                        <a href="${article.url}" target="_blank" rel="noopener noreferrer" class="card-link">
                                            Baca Selengkapnya <i data-feather="arrow-right"></i>
                                        </a>
                                    </div>
                                </div>
                            `;
                            newsContainer.innerHTML += articleCard;
                        });
                    } else {
                        newsContainer.innerHTML = '<p class="error-message">Tidak ada berita yang ditemukan.</p>';
                    }

                    const totalPages = Math.ceil(totalResults / pageSize);
                    pageInfo.textContent = `Halaman ${page} dari ${totalPages}`;
                    prevBtn.disabled = page <= 1;
                    nextBtn.disabled = page >= totalPages;
                    paginationControls.style.display = totalPages > 1 ? 'flex' : 'none';

                } catch (error) {
                    console.error('Error fetching news:', error);
                    newsContainer.innerHTML = '<p class="error-message">Gagal memuat berita. Silakan coba lagi nanti.</p>';
                    paginationControls.style.display = 'none';
                } finally {
                    feather.replace(); // Inisialisasi ulang Feather Icons
                }
            };

            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    fetchNews(currentPage);
                    window.scrollTo(0, 0); // Gulir ke atas halaman saat ganti halaman
                }
            });

            nextBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(totalResults / pageSize);
                if (currentPage < totalPages) {
                    currentPage++;
                    fetchNews(currentPage);
                    window.scrollTo(0, 0); // Gulir ke atas halaman saat ganti halaman
                }
            });

            // Panggil fungsi untuk memuat berita pertama kali
            fetchNews(currentPage);
        });
        
        // Letakkan skrip lain (hamburger, dll.) di sini jika ada
        // ...
    </script>
</body>
</html>