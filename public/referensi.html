<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Si-Mbah | Referensi Dokumen</title>

    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" href="/css/navbar.css"> 
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/chat.css">
    
    <link rel="stylesheet" href="/css/referensi.css"> 
    
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="/js/main.js" defer></script> 
</head>
<body>
    <header class="navbar scrolled">
        <a href="#" class="navbar-logo">
            <img src="/favicon.png" alt="Logo SiMbah" class="logo-icon">
            Si-Mbah<span>.</span>
        </a>
        <nav class="navbar-nav">
            <a href="/index.html">Home</a>
            <a href="/catatan.html">Catatan</a>
            <a href="/kabar.html">Kabar</a>
            <a href="/referensi.html">Referensi</a>
        </nav>
        <div class="navbar-extra">
            <a href="#" id="hamburger-menu"><i data-feather="menu"></i></a>
        </div>
    </header>

    <main class="news-section">
        <div class="container">
            <div class="news-header">
                <h1>Referensi-Mbah</h1>
                <p>Kumpulan jurnal, penelitian, dan dokumen referensi terkait dunia herbal.</p>
            </div>
            
            <div id="docs-container">
                <div class="loading-indicator">
                    <p>Sedang memuat dokumen...</p>
                </div>
            </div>

            <div class="pagination-controls" id="pagination-controls" style="display:none;">
                <button class="page-btn" id="prev-btn">Sebelumnya</button>
                <span class="page-info" id="page-info"></span>
                <button class="page-btn" id="next-btn">Berikutnya</button>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                
                <div class="footer-col">
                    <a href="#" class="footer-logo">
                        <img src="favicon.png" alt="Logo Si-Mbah" class="footer-logo-img"> 

                        Si-Mbah<span>.</span>
                    </a>
                    <p class="footer-mission">Melestarikan warisan herbal Indonesia melalui teknologi untuk generasi mendatang.</p>
                </div>
                
                <div class="footer-col">
                    <h4 class="footer-heading">Jelajahi</h4>
                    <ul class="footer-links">
                        <li><a href="#">Beranda</a></li>
                        <li><a href="#features">Fitur</a></li>
                        <li><a href="#">Tentang Kami</a></li>
                        <li><a href="#">Kontak</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h4 class="footer-heading">Dukungan</h4>
                    <ul class="footer-links">
                        <li><a href="#">Pusat Bantuan</a></li>
                        <li><a href="#">Kebijakan Privasi</a></li>
                        <li><a href="#">Syarat & Ketentuan</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h4 class="footer-heading">Terhubung Dengan Kami</h4>
                    <div class="social-links">
                        <a href="#" aria-label="Instagram"><i data-feather="instagram"></i></a>
                        <a href="#" aria-label="Facebook"><i data-feather="facebook"></i></a>
                        <a href="#" aria-label="Twitter"><i data-feather="twitter"></i></a>
                        <a href="#" aria-label="Youtube"><i data-feather="youtube"></i></a>
                    </div>
                </div>
                
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Si-Mbah. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div id="chat-bubble" class="chat-bubble">
        <i data-feather="message-square"></i>
    </div>

    <div id="chat-window" class="chat-window hidden">
        <div class="chat-header">
            <div class="header-title">
                <img src="mbah.png" alt="Icon Mbah" class="header-icon">
                <h3>Tanya-Mbah</h3>
            </div>
            <div class="header-buttons">
                <button id="clear-chat-btn" title="Hapus Obrolan"><i data-feather="trash-2"></i></button>
                <button id="collapse-chat-btn" title="Perkecil"><i data-feather="chevron-down"></i></button>
                <button id="close-chat-btn" title="Tutup"><i data-feather="x"></i></button>
            </div>
        </div>
        <div id="chat-messages" class="chat-messages">
            </div>
        <div class="chat-input-area">
            <form id="chat-form">
                <input type="text" id="chat-input" placeholder="Ketik pertanyaan Anda..." disabled>
                <button type="submit" id="send-btn" disabled><i data-feather="send"></i></button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const docsContainer = document.getElementById('docs-container');
            const paginationControls = document.getElementById('pagination-controls');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const pageInfo = document.getElementById('page-info');

            // -- PENGATURAN PAGINATION --
            let allDocuments = []; // Menyimpan semua dokumen dari API
            let currentPage = 1;
            const pageSize = 10; // 10 dokumen per halaman

            // Fungsi untuk menampilkan dokumen pada halaman tertentu
            const displayPage = (page) => {
                currentPage = page;
                docsContainer.innerHTML = ''; // Kosongkan container

                // Hitung indeks awal dan akhir untuk data halaman ini
                const startIndex = (page - 1) * pageSize;
                const endIndex = startIndex + pageSize;
                const documentsOnPage = allDocuments.slice(startIndex, endIndex);

                // Tampilkan dokumen untuk halaman ini
                if (documentsOnPage.length > 0) {
                    documentsOnPage.forEach(doc => {
                        const title = doc.file.replace('.pdf', '').replace(/_/g, ' ');
                        const docCard = `
                            <div class="doc-card">
                                <div class="doc-icon">
                                    <i data-feather="file-text"></i>
                                </div>
                                <div class="doc-content">
                                    <h3 class="doc-title">${title}</h3>
                                    <p class="doc-meta">Jenis Dokumen: PDF</p>
                                    <p class="doc-description">Dokumen penelitian ilmiah dan referensi pustaka yang dapat Anda baca dan unduh.</p>
                                    <a href="/documents/${doc.file}" target="_blank" rel="noopener noreferrer" class="doc-link">
                                        Buka Dokumen
                                        <i data-feather="external-link"></i>
                                    </a>
                                </div>
                            </div>
                        `;
                        docsContainer.innerHTML += docCard;
                    });
                } else {
                    docsContainer.innerHTML = '<p class="error-message">Tidak ada dokumen di halaman ini.</p>';
                }

                // Update info dan tombol pagination
                updatePaginationControls();
                feather.replace(); // Inisialisasi ulang ikon
                window.scrollTo(0, 0); // Gulir ke atas halaman
            };

            // Fungsi untuk memperbarui kontrol pagination
            const updatePaginationControls = () => {
                const totalPages = Math.ceil(allDocuments.length / pageSize);

                if (totalPages > 1) {
                    paginationControls.style.display = 'flex';
                    pageInfo.textContent = `Halaman ${currentPage} dari ${totalPages}`;
                    prevBtn.disabled = currentPage === 1;
                    nextBtn.disabled = currentPage === totalPages;
                } else {
                    paginationControls.style.display = 'none';
                }
            };

            // Ambil semua data sekali, lalu kelola dengan pagination
            const fetchAllDocuments = async () => {
                try {
                    const response = await fetch('/api/documents');
                    if (!response.ok) throw new Error('Gagal mengambil data');
                    
                    const data = await response.json();
                    allDocuments = data.documents || [];

                    if (allDocuments.length > 0) {
                        displayPage(1); // Tampilkan halaman pertama
                    } else {
                        docsContainer.innerHTML = '<p class="error-message">Tidak ada dokumen referensi yang ditemukan.</p>';
                    }
                } catch (error) {
                    console.error('Error fetching documents:', error);
                    docsContainer.innerHTML = `<p class="error-message">${error.message}</p>`;
                }
            };
            
            // Tambahkan event listener untuk tombol
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    displayPage(currentPage - 1);
                }
            });

            nextBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(allDocuments.length / pageSize);
                if (currentPage < totalPages) {
                    displayPage(currentPage + 1);
                }
            });

            // Panggil fungsi awal
            fetchAllDocuments();
        });

    window.onscroll = function() {
        const header = document.querySelector('header.navbar');
        const fixedNav = header.offsetTop;
    };

    // Fungsi Hamburger Menu
    const hamburger = document.querySelector('#hamburger-menu');
    const navbarNav = document.querySelector('.navbar-nav');

    hamburger.onclick = (e) => {
        navbarNav.classList.toggle('active');
        e.preventDefault(); // Mencegah aksi default
    };

    // Klik di luar sidebar untuk menghilangkan nav
    document.addEventListener('click', function(e) {
        if (!hamburger.contains(e.target) && !navbarNav.contains(e.target)) {
            navbarNav.classList.remove('active');
        }
    });

    // Initialize Feather Icons
    feather.replace();

    // Animate numbers when in viewport
    function animateNumbers() {
        const statNumbers = document.querySelectorAll('.stat-number');
        
        statNumbers.forEach(stat => {
            const target = stat.textContent;
            const number = parseInt(target.replace(/[^\d]/g, ''));
            const suffix = target.replace(/[\d]/g, '');
            
            if (number && !stat.classList.contains('animated')) {
                stat.classList.add('animated');
                let current = 0;
                const increment = number / 40;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= number) {
                        current = number;
                        clearInterval(timer);
                    }
                    stat.textContent = Math.floor(current) + suffix;
                }, 40);
            }
        });
    }

    // Trigger animation when section is visible
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                animateNumbers();
            }
        });
    }, { threshold: 0.5 });

    observer.observe(document.querySelector('.statistics'));
    </script>

</body>
</html>